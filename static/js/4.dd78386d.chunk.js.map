{"version":3,"sources":["components/common/CardHeader/CardHeader.js","constants/constants.js","components/sidePanel/Events/Events.js","components/sidePanel/Conditions/Conditions.js","components/sidePanel/Actions/Actions.js","components/ButtonSelectorNode/ButtonSelectorNode.js","views/home/HomePage.js"],"names":["CardHeader","props","handleSave","hasPreviewButton","handlePreview","children","rest","className","IconButton","disableRipple","Button","variant","onClick","SAMPLE_EVENT_TRIGGERS","eventKey","eventDisplay","fields","conditionKey","conditionDisplay","type","options","SAMPLE_ACTIONS","actionKey","actionDisplay","key","placeHolder","option","CONDITION_OPERATORS","name","value","SAMPLE_FLOW","operator","actionInputs","Events","handleSelect","selectedEventKey","useState","showMore","setShowMore","Typography","length","map","item","startIcon","endIcon","Conditions","selectedConditionObj","useEffect","setConditions","Object","keys","includes","values","setMustMeet","initialConditionObj","selectedEventFields","find","t","mustMeet","conditions","arrayEquals","a","b","Array","isArray","every","val","index","handleOnChange","keyName","tempConditions","assign","split","FormControl","InputLabel","id","Select","labelId","onChange","e","target","MenuItem","c","i","Fragment","splice","handleOnRemove","f","filter","o","TextField","fullWidth","margin","join","label","FormHelperText","v","setModalState","title","subtitle","btnLabel","firstCondition","groupedConditions","console","log","result","Actions","actionsArr","handleAddAction","selectedActionObj","fieldKeyValue","setFieldKeyValue","setClickedAction","formatActionInputs","onFocusObj","reduce","obj","clickedAction","handleFieldInputChange","field","test","tempFieldKeyValue","action","opt","placeholder","entries","memo","data","isConnectable","selectedElements","useStoreState","store","focusNodeAction","disabled","btnAction","stopPropagation","handleRemoveNode","cond","replace","handleSelectAction","ai","handleDeleteAction","btnLabel2","btnAction2","position","style","bottom","top","background","nodeTypes","btnSelectorNode","ButtonSelectorNode","totalConditionsCount","HomePage","window","innerWidth","persistent","initEventNodeElement","nodeId","x","y","toString","setShowDrawer","setSelectedNode","initConditionNodeElement","handleSwapConditionArrows","nodeType","initActionNodeElement","setSelectedActionIndex","itemIndex","initChoiceNodeElement","tempElems","elementsStateRef","current","Number","push","initNodeEdge","source","labelBgPadding","labelBgBorderRadius","labelStyle","fill","fontWeight","labelBgStyle","setElements","showDrawer","selectedNode","selectedActionIndex","elements","useRef","selectedNodeStateRef","tempElemIndex","findIndex","targetNode","RegExp","tempElements","yesNodeIndex","el","noNodeIndex","recursionFormObj","yesNodeId","noNodeId","recursionFromElement","conditionObj","Background","fullHeight","color","event","actionObj","slice","initialElements","sampleFlowConditions","output","noCondition","elementsSelectable","onElementsRemove","elementsToRemove","els","removeElements","onConnect","params","addEdge","onSelectionChange"],"mappings":"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","file":"static/js/4.dd78386d.chunk.js","sourcesContent":["import React from \"react\";\r\nimport InfoOutlinedIcon from \"@material-ui/icons/InfoOutlined\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\n\r\nimport \"./CardHeader.scss\";\r\n\r\nconst CardHeader = props => {\r\n  const { handleSave, hasPreviewButton, handlePreview, children, ...rest } =\r\n    props;\r\n\r\n  return (\r\n    <div className={`CardHeader`} {...rest}>\r\n      <div className=\"left-section\">\r\n        {children}\r\n        <IconButton disableRipple>\r\n          <InfoOutlinedIcon />\r\n        </IconButton>\r\n      </div>\r\n      <div className=\"d-flex\">\r\n        {hasPreviewButton && (\r\n          <Button\r\n            variant=\"text\"\r\n            className=\"btn-preview\"\r\n            onClick={handlePreview}\r\n          >\r\n            View Preset Flow\r\n          </Button>\r\n        )}\r\n        {handleSave && (\r\n          <Button variant=\"contained\" onClick={handleSave}>\r\n            Save\r\n          </Button>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport { CardHeader };\r\n","export const SAMPLE_EVENT_TRIGGERS = [\r\n  {\r\n    eventKey: \"NewOrder\",\r\n    eventDisplay: \"New order placed\",\r\n    fields: [\r\n      {\r\n        conditionKey: \"ProductTitle\",\r\n        conditionDisplay: \"Product Title\",\r\n        type: \"string\"\r\n      },\r\n      {\r\n        conditionKey: \"ProductAmount\",\r\n        conditionDisplay: \"Product Amount\",\r\n        type: \"int\"\r\n      }\r\n    ]\r\n  },\r\n  {\r\n    eventKey: \"NewSignup\",\r\n    eventDisplay: \"New signup\",\r\n    fields: [\r\n      {\r\n        conditionKey: \"Gender\",\r\n        conditionDisplay: \"Customer Gender\",\r\n        type: \"option\",\r\n        options: [\"Male\", \"Female\"]\r\n      },\r\n      { conditionKey: \"DOB\", conditionDisplay: \"Birthday\", type: \"date\" }\r\n    ]\r\n  }\r\n];\r\n\r\nexport const SAMPLE_ACTIONS = [\r\n  {\r\n    actionKey: \"SendEmail\",\r\n    actionDisplay: \"Send email to contact\",\r\n    fields: [\r\n      { key: \"emailAddress\", placeHolder: \"Email Address\", type: \"string\" }\r\n    ]\r\n  },\r\n  {\r\n    actionKey: \"CallContact\",\r\n    actionDisplay: \"Call contact\",\r\n    fields: [\r\n      { key: \"callContact\", placeHolder: \"Contact Number\", type: \"string\" },\r\n      {\r\n        key: \"callContactCountry\",\r\n        placeHolder: \"Country\",\r\n        type: \"selection\",\r\n        option: [\"Singapore\", \"Malaysia\"]\r\n      }\r\n    ]\r\n  }\r\n];\r\n\r\nexport const CONDITION_OPERATORS = [\r\n  { name: \"Equal\", value: \"=\", type: \"string\" },\r\n  { name: \"Not equal\", value: \"!=\", type: \"string\" },\r\n  { name: \"Contains\", value: \"contains\", type: \"string\" },\r\n  { name: \"Not contains\", value: \"not contains\", type: \"string\" },\r\n  { name: \"Greater than\", value: \">\", type: \"int\" },\r\n  { name: \"Less than\", value: \"<\", type: \"int\" },\r\n  { name: \"Greater and equal than\", value: \">=\", type: \"int\" },\r\n  { name: \"Less and equal than\", value: \"<=\", type: \"int\" },\r\n  { name: \"Equal\", value: \"=\", type: \"date\" },\r\n  { name: \"Earlier than\", value: \"earlier than\", type: \"date\" },\r\n  { name: \"Later than\", value: \"later than\", type: \"date\" }\r\n];\r\n\r\nexport const SAMPLE_FLOW = {\r\n  eventKey: \"NewOrder\",\r\n  conditions: [\r\n    {\r\n      \"Fn::If\": [\r\n        [\r\n          {\r\n            \"Fn::And\": [\r\n              {\r\n                conditionKey: \"ProductTitle\",\r\n                value: [\"coke\", \"pepsi\"],\r\n                operator: \"contains\"\r\n              },\r\n              {\r\n                conditionKey: \"ProductAmount\",\r\n                value: [\"30\"],\r\n                operator: \">=\"\r\n              }\r\n            ]\r\n          }\r\n        ],\r\n        [\r\n          {\r\n            \"Fn::If\": [\r\n              [\r\n                {\r\n                  conditionKey: \"ProductTitle\",\r\n                  value: [\"coke\"],\r\n                  operator: \"=\"\r\n                }\r\n              ],\r\n              [\r\n                {\r\n                  actionKey: \"CallContact\",\r\n                  actionInputs: [\r\n                    {\r\n                      key: \"callContact\",\r\n                      value: \"999\"\r\n                    },\r\n                    {\r\n                      key: \"callContactCountry\",\r\n                      value: \"Singapore\"\r\n                    }\r\n                  ]\r\n                }\r\n              ],\r\n              [\r\n                {\r\n                  actionKey: \"SendEmail\",\r\n                  actionInputs: [\r\n                    {\r\n                      key: \"emailAddress\",\r\n                      value: \"simon@gmail.com\"\r\n                    }\r\n                  ]\r\n                }\r\n              ]\r\n            ]\r\n          }\r\n        ],\r\n        [\r\n          {\r\n            actionKey: \"CallContact\",\r\n            actionInputs: [\r\n              {\r\n                key: \"callContact\",\r\n                value: \"0123456789\"\r\n              },\r\n              {\r\n                key: \"callContactCountry\",\r\n                value: \"Malaysia\"\r\n              }\r\n            ]\r\n          },\r\n          {\r\n            actionKey: \"SendEmail\",\r\n            actionInputs: [\r\n              {\r\n                key: \"emailAddress\",\r\n                value: \"hello@gmail.com\"\r\n              }\r\n            ]\r\n          }\r\n        ]\r\n      ]\r\n    }\r\n  ]\r\n};\r\n","import React, { useState } from \"react\";\r\nimport PropTypes from \"prop-types\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport { CardHeader } from \"components/common/CardHeader/CardHeader\";\r\nimport AddBoxOutlinedIcon from \"@material-ui/icons/AddBoxOutlined\";\r\nimport KeyboardArrowUpOutlinedIcon from \"@material-ui/icons/KeyboardArrowUpOutlined\";\r\nimport KeyboardArrowDownOutlinedIcon from \"@material-ui/icons/KeyboardArrowDownOutlined\";\r\nimport { SAMPLE_EVENT_TRIGGERS } from \"constants/constants\";\r\n\r\nimport \"./Events.scss\";\r\n\r\nconst Events = props => {\r\n  const { handleSelect, selectedEventKey, ...rest } = props;\r\n  const [showMore, setShowMore] = useState(false);\r\n\r\n  return (\r\n    <div className={`Events`} {...rest}>\r\n      <CardHeader>\r\n        <Typography variant=\"h3\">Events</Typography>\r\n      </CardHeader>\r\n\r\n      <div\r\n        className={`content-body ${\r\n          SAMPLE_EVENT_TRIGGERS.length > 3 ? \"has-show-more\" : \"\"\r\n        } ${showMore ? \"show-all\" : \"\"}`}\r\n        {...rest}\r\n      >\r\n        {SAMPLE_EVENT_TRIGGERS.map(item => (\r\n          <Button\r\n            key={item.eventKey}\r\n            onClick={() => handleSelect(item)}\r\n            disableRipple\r\n            variant=\"text\"\r\n            className={`btn-card-item ${\r\n              selectedEventKey === item.eventKey ? \"on-focus\" : \"\"\r\n            }`}\r\n            startIcon={<AddBoxOutlinedIcon />}\r\n          >\r\n            {item.eventDisplay}\r\n          </Button>\r\n        ))}\r\n      </div>\r\n\r\n      {SAMPLE_EVENT_TRIGGERS.length > 3 && (\r\n        <div className=\"btn-show-more\">\r\n          <Button\r\n            onClick={() => setShowMore(!showMore)}\r\n            variant=\"text\"\r\n            disableRipple\r\n            endIcon={\r\n              showMore ? (\r\n                <KeyboardArrowUpOutlinedIcon />\r\n              ) : (\r\n                <KeyboardArrowDownOutlinedIcon />\r\n              )\r\n            }\r\n          >\r\n            Show {showMore ? \"less\" : \"more\"}\r\n          </Button>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nEvents.propTypes = {\r\n  selectedEventKey: PropTypes.string,\r\n  handleSelect: PropTypes.func\r\n};\r\nexport { Events };\r\n","import React, { useState, useEffect } from \"react\";\r\nimport PropTypes from \"prop-types\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport InputLabel from \"@material-ui/core/InputLabel\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\nimport FormControl from \"@material-ui/core/FormControl\";\r\nimport FormHelperText from \"@material-ui/core/FormHelperText\";\r\nimport Select from \"@material-ui/core/Select\";\r\nimport ClearIcon from \"@material-ui/icons/Clear\";\r\nimport AddBoxOutlinedIcon from \"@material-ui/icons/AddBoxOutlined\";\r\nimport { setModalState } from \"states/modalState\";\r\nimport { CardHeader } from \"components/common/CardHeader/CardHeader\";\r\nimport {\r\n  SAMPLE_EVENT_TRIGGERS,\r\n  CONDITION_OPERATORS\r\n} from \"constants/constants\";\r\n\r\nimport \"./Conditions.scss\";\r\n\r\nconst Conditions = props => {\r\n  const { selectedEventKey, selectedConditionObj, handleSelect, ...rest } =\r\n    props;\r\n\r\n  useEffect(() => {\r\n    setConditions(\r\n      Object.keys(selectedConditionObj)[0]?.includes(\"Fn::\")\r\n        ? Object.values(selectedConditionObj)[0]\r\n        : [\r\n            {\r\n              conditionKey: selectedConditionObj.conditionKey || \"\",\r\n              value: selectedConditionObj.value || [],\r\n              operator: selectedConditionObj.operator || \"\"\r\n            }\r\n          ]\r\n    );\r\n    setMustMeet(\r\n      Object.keys(selectedConditionObj)[0]?.includes(\"Fn::\")\r\n        ? Object.keys(selectedConditionObj)[0]\r\n        : \"\"\r\n    );\r\n  }, [selectedConditionObj]);\r\n\r\n  const initialConditionObj = {\r\n    conditionKey: \"\",\r\n    value: [],\r\n    operator: \"\"\r\n  };\r\n\r\n  const selectedEventFields = SAMPLE_EVENT_TRIGGERS.find(\r\n    t => t.eventKey === selectedEventKey\r\n  ).fields;\r\n\r\n  const [mustMeet, setMustMeet] = useState(\"\");\r\n  const [conditions, setConditions] = useState([\r\n    {\r\n      conditionKey: \"\",\r\n      value: [],\r\n      operator: \"\"\r\n    }\r\n  ]);\r\n\r\n  const handleOnAdd = () => {\r\n    if (!mustMeet) {\r\n      setMustMeet(\"Fn::And\");\r\n    }\r\n    setConditions([...conditions, initialConditionObj]);\r\n  };\r\n\r\n  const arrayEquals = (a, b) => {\r\n    return (\r\n      Array.isArray(a) &&\r\n      Array.isArray(b) &&\r\n      a.length === b.length &&\r\n      a.every((val, index) => val === b[index])\r\n    );\r\n  };\r\n\r\n  const handleOnSave = () => {\r\n    // Empty field validation\r\n    if (\r\n      conditions.find(\r\n        c => !c.conditionKey || !c.operator || c.value.filter(v => !v).length\r\n      )\r\n    ) {\r\n      setModalState({\r\n        title: \"Warning\",\r\n        subtitle: \"Please complete the condition fields before saving\",\r\n        btnLabel: \"OK\"\r\n      });\r\n      return;\r\n    }\r\n\r\n    // Validate contradiction\r\n    if (\r\n      conditions.length > 1 &&\r\n      (conditions.find(c => c.operator === \">\")?.value[0] >\r\n        conditions.find(c => c.operator === \"<\" || c.operator === \"<=\")\r\n          ?.value[0] ||\r\n        conditions.find(c => c.operator === \">=\")?.value[0] >=\r\n          conditions.find(c => c.operator === \"<=\" || c.operator === \"<\")\r\n            ?.value[0] ||\r\n        (conditions.find(c => c.operator === \"later than\")?.value &&\r\n          conditions.find(c => c.operator === \"earlier than\")?.value &&\r\n          conditions.find(c => c.operator === \"later than\")?.value[0] >\r\n            conditions.find(c => c.operator === \"earlier than\")?.value[0]) ||\r\n        (conditions.find(c => c.operator === \"=\")?.value &&\r\n          conditions.find(c => c.operator === \"!=\")?.value &&\r\n          arrayEquals(\r\n            conditions.find(c => c.operator === \"=\").value,\r\n            conditions.find(c => c.operator === \"!=\").value\r\n          )) ||\r\n        (conditions.find(c => c.operator === \"contains\")?.value &&\r\n          conditions.find(c => c.operator === \"not contains\")?.value &&\r\n          arrayEquals(\r\n            conditions.find(c => c.operator === \"contains\").value,\r\n            conditions.find(c => c.operator === \"not contains\").value\r\n          )))\r\n    ) {\r\n      setModalState({\r\n        title: \"Warning\",\r\n        subtitle: \"Conditions have contradiction. Please try again.\",\r\n        btnLabel: \"OK\"\r\n      });\r\n      return;\r\n    }\r\n\r\n    let tempConditions = Object.assign([], conditions);\r\n    while (tempConditions.length > 0) {\r\n      const firstCondition = tempConditions[0];\r\n      const groupedConditions = tempConditions.filter(\r\n        c => c.conditionKey === firstCondition.conditionKey\r\n      );\r\n      // groupedConditions.filter(g=>g.value.includes())\r\n\r\n      tempConditions = tempConditions.filter(c =>\r\n        groupedConditions.includes(c.conditionKey)\r\n      );\r\n    }\r\n    console.log(conditions);\r\n    const result = mustMeet ? { [mustMeet]: conditions } : conditions[0];\r\n    handleSelect(result);\r\n  };\r\n\r\n  const handleOnRemove = index => {\r\n    if (conditions.length === 2) {\r\n      setMustMeet(\"\");\r\n    }\r\n    const tempConditions = Object.assign([], conditions);\r\n    tempConditions.splice(index, 1);\r\n    setConditions(tempConditions);\r\n  };\r\n\r\n  const handleOnChange = (value, index, keyName) => {\r\n    const tempConditions = Object.assign([], conditions);\r\n    if (keyName === \"value\") {\r\n      tempConditions[index].value = value.split(\",\");\r\n    } else {\r\n      tempConditions[index][keyName] = value;\r\n    }\r\n    setConditions(tempConditions);\r\n  };\r\n\r\n  return (\r\n    <div className={`Conditions`} {...rest}>\r\n      <CardHeader>\r\n        <Typography variant=\"h3\">Conditions</Typography>\r\n      </CardHeader>\r\n\r\n      <div className={`content-body`} {...rest}>\r\n        {conditions.length > 1 && (\r\n          <FormControl className=\"mb-1-5\">\r\n            <InputLabel id={`label-must-meet`}>\r\n              All conditions must meet\r\n            </InputLabel>\r\n            <Select\r\n              labelId={`label-must-meet`}\r\n              id=\"must-meet\"\r\n              value={mustMeet}\r\n              onChange={e => setMustMeet(e.target.value)}\r\n            >\r\n              <MenuItem value=\"Fn::And\">AND</MenuItem>\r\n              <MenuItem value=\"Fn::Or\">OR</MenuItem>\r\n            </Select>\r\n          </FormControl>\r\n        )}\r\n\r\n        {conditions.map((c, i) => (\r\n          <React.Fragment key={i}>\r\n            {i !== 0 && (\r\n              <Button\r\n                className=\"btn-clear\"\r\n                variant=\"text\"\r\n                startIcon={<ClearIcon />}\r\n                disableRipple\r\n                onClick={() => handleOnRemove(i)}\r\n              >\r\n                Remove\r\n              </Button>\r\n            )}\r\n            <FormControl>\r\n              <InputLabel id={`label-condition-${i}`}>\r\n                Condition {i + 1}\r\n              </InputLabel>\r\n              <Select\r\n                labelId={`label-condition-${i}`}\r\n                id={`condition-${i}`}\r\n                value={c.conditionKey || \"\"}\r\n                onChange={e =>\r\n                  handleOnChange(e.target.value, i, \"conditionKey\")\r\n                }\r\n              >\r\n                {selectedEventFields.map(item => (\r\n                  <MenuItem key={item.conditionKey} value={item.conditionKey}>\r\n                    {item.conditionDisplay}\r\n                  </MenuItem>\r\n                ))}\r\n              </Select>\r\n            </FormControl>\r\n\r\n            <FormControl>\r\n              <InputLabel id={`label-operator-${i}`}>\r\n                Operator {i + 1}\r\n              </InputLabel>\r\n              <Select\r\n                labelId={`label-operator-${i}`}\r\n                id={`operator-${i}`}\r\n                value={c.operator || \"\"}\r\n                onChange={e => handleOnChange(e.target.value, i, \"operator\")}\r\n              >\r\n                {selectedEventFields.find(\r\n                  f => f.conditionKey === c.conditionKey\r\n                )?.type === \"option\"\r\n                  ? selectedEventFields\r\n                      .find(f => f.conditionKey === c.conditionKey)\r\n                      .options.map(option => (\r\n                        <MenuItem key={option} value={option}>\r\n                          {option}\r\n                        </MenuItem>\r\n                      ))\r\n                  : CONDITION_OPERATORS.filter(\r\n                      o =>\r\n                        o.type ===\r\n                        selectedEventFields.find(\r\n                          f => f.conditionKey === c.conditionKey\r\n                        )?.type\r\n                    )?.map(operator => (\r\n                      <MenuItem key={operator.value} value={operator.value}>\r\n                        {operator.name}\r\n                      </MenuItem>\r\n                    ))}\r\n              </Select>\r\n            </FormControl>\r\n\r\n            <FormControl>\r\n              <TextField\r\n                fullWidth\r\n                margin=\"dense\"\r\n                onChange={e => handleOnChange(e.target.value, i, \"value\")}\r\n                type={\"text\"}\r\n                value={c.value.join(\",\") || \"\"}\r\n                label={`Value ${i + 1}`}\r\n              />\r\n              <FormHelperText>\r\n                Please separate multiple values by comma\r\n              </FormHelperText>\r\n            </FormControl>\r\n\r\n            {conditions.length - 1 !== i && (\r\n              <Typography variant=\"h6\" className=\"must-meet-separator\">\r\n                {mustMeet === \"Fn::And\" ? \"AND\" : \"OR\"}\r\n              </Typography>\r\n            )}\r\n          </React.Fragment>\r\n        ))}\r\n\r\n        <Button\r\n          variant=\"text\"\r\n          startIcon={<AddBoxOutlinedIcon />}\r\n          disableRipple\r\n          className=\"btn-add\"\r\n          onClick={handleOnAdd}\r\n        >\r\n          Add Condition\r\n        </Button>\r\n        <Button variant=\"contained\" disableRipple onClick={handleOnSave}>\r\n          Save Condition\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nConditions.propTypes = {\r\n  selectedEventKey: PropTypes.string,\r\n  selectedConditionObj: PropTypes.object,\r\n  handleSelect: PropTypes.func\r\n};\r\nexport { Conditions };\r\n","import React, { useState, useEffect } from \"react\";\r\nimport PropTypes from \"prop-types\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport InputLabel from \"@material-ui/core/InputLabel\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\nimport FormControl from \"@material-ui/core/FormControl\";\r\nimport Select from \"@material-ui/core/Select\";\r\nimport { CardHeader } from \"components/common/CardHeader/CardHeader\";\r\nimport AddBoxOutlinedIcon from \"@material-ui/icons/AddBoxOutlined\";\r\nimport KeyboardArrowUpOutlinedIcon from \"@material-ui/icons/KeyboardArrowUpOutlined\";\r\nimport KeyboardArrowDownOutlinedIcon from \"@material-ui/icons/KeyboardArrowDownOutlined\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport { setModalState } from \"states/modalState\";\r\nimport { SAMPLE_ACTIONS } from \"constants/constants\";\r\n\r\nimport \"./Actions.scss\";\r\n\r\nconst Actions = props => {\r\n  const {\r\n    handleSelect,\r\n    handleAddAction,\r\n    actionsArr,\r\n    selectedActionObj,\r\n    ...rest\r\n  } = props;\r\n\r\n  const [fieldKeyValue, setFieldKeyValue] = useState({});\r\n\r\n  useEffect(() => {\r\n    if (Object.keys(selectedActionObj).length) {\r\n      setClickedAction(formatActionInputs(selectedActionObj));\r\n    } else {\r\n      setClickedAction({});\r\n      setFieldKeyValue({});\r\n    }\r\n  }, [selectedActionObj]);\r\n\r\n  const formatActionInputs = onFocusObj => {\r\n    setFieldKeyValue(\r\n      onFocusObj.actionInputs.reduce((map, obj) => {\r\n        map[obj.key] = obj.value;\r\n        return map;\r\n      }, {})\r\n    );\r\n    return SAMPLE_ACTIONS.find(f => f.actionKey === onFocusObj.actionKey);\r\n  };\r\n\r\n  const [clickedAction, setClickedAction] = useState({});\r\n  const [showMore, setShowMore] = useState(false);\r\n\r\n  const handleOnClickAction = action => {\r\n    setClickedAction(action);\r\n  };\r\n\r\n  const handleOnAddOrUpdate = () => {\r\n    if (\r\n      clickedAction.fields.length !== Object.keys(fieldKeyValue).length ||\r\n      Object.values(fieldKeyValue).filter(v => !v).length\r\n    ) {\r\n      setModalState({\r\n        title: \"Warning\",\r\n        subtitle: \"Please complete the action fields before saving\",\r\n        btnLabel: \"OK\"\r\n      });\r\n      return;\r\n    }\r\n    const result = {\r\n      actionKey: clickedAction.actionKey,\r\n      actionInputs: Object.entries(fieldKeyValue).map(f => ({\r\n        key: f[0],\r\n        value: f[1]\r\n      }))\r\n    };\r\n    handleSelect(\r\n      result,\r\n      Object.keys(selectedActionObj).length ? \"update\" : \"add\"\r\n    );\r\n  };\r\n\r\n  const handleFieldInputChange = (e, field) => {\r\n    if (field.key === \"callContact\" && !/^[0-9]*$/.test(e.target.value)) {\r\n      return;\r\n    }\r\n    const tempFieldKeyValue = Object.assign({}, fieldKeyValue);\r\n    tempFieldKeyValue[field.key] = e.target.value;\r\n    setFieldKeyValue(tempFieldKeyValue);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <div className={`Actions`} {...rest}>\r\n        <CardHeader>\r\n          <Typography variant=\"h3\">Actions</Typography>\r\n        </CardHeader>\r\n\r\n        <div\r\n          className={`content-body ${\r\n            SAMPLE_ACTIONS.length > 3 ? \"has-show-more\" : \"\"\r\n          } ${showMore ? \"show-all\" : \"\"}`}\r\n          {...rest}\r\n        >\r\n          {SAMPLE_ACTIONS.filter(\r\n            action =>\r\n              !actionsArr.map(a => a.actionKey).includes(action.actionKey)\r\n          ).map(item => (\r\n            <Button\r\n              key={item.actionKey}\r\n              onClick={() => handleOnClickAction(item)}\r\n              disableRipple\r\n              variant=\"text\"\r\n              className={`btn-card-item ${\r\n                clickedAction?.actionKey === item.actionKey ? \"on-focus\" : \"\"\r\n              }`}\r\n              startIcon={<AddBoxOutlinedIcon />}\r\n            >\r\n              {item.actionDisplay}\r\n            </Button>\r\n          ))}\r\n\r\n          {!SAMPLE_ACTIONS.filter(\r\n            action =>\r\n              !actionsArr.map(a => a.actionKey).includes(action.actionKey)\r\n          ).length && (\r\n            <Typography variant=\"body1\" className=\"label-no-more\">\r\n              No action available\r\n            </Typography>\r\n          )}\r\n        </div>\r\n\r\n        {SAMPLE_ACTIONS.length > 3 && (\r\n          <div className=\"btn-show-more\">\r\n            <Button\r\n              onClick={() => setShowMore(!showMore)}\r\n              variant=\"text\"\r\n              disableRipple\r\n              endIcon={\r\n                showMore ? (\r\n                  <KeyboardArrowUpOutlinedIcon />\r\n                ) : (\r\n                  <KeyboardArrowDownOutlinedIcon />\r\n                )\r\n              }\r\n            >\r\n              Show {showMore ? \"less\" : \"more\"}\r\n            </Button>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {Object.keys(clickedAction).length > 0 && (\r\n        <>\r\n          <CardHeader>\r\n            <Typography variant=\"h3\">Action Details</Typography>\r\n          </CardHeader>\r\n          <div className=\"card-body\">\r\n            {clickedAction.fields.map(field =>\r\n              field.type === \"selection\" ? (\r\n                <FormControl key={field.key}>\r\n                  <InputLabel id={`label-${field.key}`}>\r\n                    {field.placeHolder}\r\n                  </InputLabel>\r\n                  <Select\r\n                    labelId={`label-${field.key}`}\r\n                    id={field.key}\r\n                    value={fieldKeyValue[field.key] || \"\"}\r\n                    onChange={e => handleFieldInputChange(e, field)}\r\n                  >\r\n                    {field.option.map(opt => (\r\n                      <MenuItem key={opt} value={opt}>\r\n                        {opt}\r\n                      </MenuItem>\r\n                    ))}\r\n                  </Select>\r\n                </FormControl>\r\n              ) : (\r\n                <TextField\r\n                  key={field.key}\r\n                  fullWidth\r\n                  margin=\"dense\"\r\n                  onChange={e => handleFieldInputChange(e, field)}\r\n                  type={\"text\"}\r\n                  value={fieldKeyValue[field.key] || \"\"}\r\n                  label={field.placeHolder}\r\n                  placeholder={field.placeHolder}\r\n                />\r\n              )\r\n            )}\r\n            <Button\r\n              variant=\"contained\"\r\n              className=\"mt-1\"\r\n              disableRipple\r\n              onClick={handleOnAddOrUpdate}\r\n            >\r\n              {Object.keys(selectedActionObj).length ? \"Update\" : \"Add\"}\r\n            </Button>\r\n          </div>\r\n        </>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nActions.propTypes = {\r\n  handleSelect: PropTypes.func,\r\n  handleAddAction: PropTypes.func,\r\n  actionsArr: PropTypes.array,\r\n  selectedActionObj: PropTypes.object\r\n};\r\nexport { Actions };\r\n","import React, { memo } from \"react\";\r\n\r\nimport { Handle, useStoreState } from \"react-flow-renderer\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport HighlightOffIcon from \"@material-ui/icons/HighlightOff\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\n// import LoopIcon from \"@material-ui/icons/Loop\";\r\n\r\nimport \"./ButtonSelectorNode.scss\";\r\n\r\nexport default memo(({ id, data, isConnectable }) => {\r\n  const selectedElements = useStoreState(store => store.selectedElements);\r\n\r\n  return (\r\n    <div\r\n      className={`ButtonSelectorNode ${\r\n        selectedElements && selectedElements[0].id === id ? \"is-selected\" : \"\"\r\n      }`}\r\n      onClick={() => data.focusNodeAction(id)}\r\n    >\r\n      <Typography variant=\"body1\" className=\"node-label\">\r\n        {data.label}\r\n      </Typography>\r\n\r\n      {/* Event type */}\r\n      {data.type === \"event\" &&\r\n        (data.item ? (\r\n          <Button variant=\"text\" disabled className=\"lbl-event\">\r\n            {data.item?.eventDisplay}\r\n          </Button>\r\n        ) : (\r\n          data.btnLabel && (\r\n            <Button\r\n              onClick={e => {\r\n                data.btnAction(id);\r\n                e.stopPropagation();\r\n              }}\r\n              variant=\"text\"\r\n            >\r\n              {data.btnLabel}\r\n            </Button>\r\n          )\r\n        ))}\r\n\r\n      {/* Condition or Choice type */}\r\n      {(data.type === \"condition\" || data.type === \"choice\") && (\r\n        <>\r\n          {data.type === \"condition\" && (\r\n            <>\r\n              {/* <IconButton\r\n                disableRipple\r\n                className=\"btn-swap\"\r\n                onClick={e => {\r\n                  data.handleSwapConditionArrows(id);\r\n                  e.stopPropagation();\r\n                }}\r\n              >\r\n                <LoopIcon />\r\n              </IconButton> */}\r\n              <IconButton\r\n                disableRipple\r\n                className=\"btn-delete\"\r\n                onClick={e => {\r\n                  data.handleRemoveNode(id, \"condition\");\r\n                  e.stopPropagation();\r\n                }}\r\n              >\r\n                <HighlightOffIcon />\r\n              </IconButton>\r\n            </>\r\n          )}\r\n          {data.item ? (\r\n            <Button variant=\"text\" disabled className=\"lbl-condition\">\r\n              {Object.keys(data.item)[0].includes(\"Fn::\")\r\n                ? Object.values(data.item)[0]\r\n                    .map(\r\n                      cond =>\r\n                        `${cond.conditionKey} ${\r\n                          cond.operator\r\n                        } ${cond.value.join(\", \")}`\r\n                    )\r\n                    .join(` ${Object.keys(data.item)[0].replace(\"Fn::\", \"\")} `)\r\n                : `${data.item.conditionKey} ${\r\n                    data.item.operator\r\n                  } ${data.item.value.join(\", \")}`}\r\n            </Button>\r\n          ) : (\r\n            data.btnLabel && (\r\n              <Button\r\n                onClick={e => {\r\n                  data.btnAction(id);\r\n                  e.stopPropagation();\r\n                }}\r\n                variant=\"text\"\r\n              >\r\n                {data.btnLabel}\r\n              </Button>\r\n            )\r\n          )}\r\n        </>\r\n      )}\r\n\r\n      {/* Action Type */}\r\n      {data.type === \"action\" && id === \"2\" && !data.item?.length && (\r\n        <IconButton\r\n          disableRipple\r\n          className=\"btn-delete\"\r\n          onClick={e => {\r\n            data.handleRemoveNode(id, \"condition\");\r\n            e.stopPropagation();\r\n          }}\r\n        >\r\n          <HighlightOffIcon />\r\n        </IconButton>\r\n      )}\r\n      {data.type === \"action\" &&\r\n        (data.item?.length ? (\r\n          <>\r\n            {data.item.map((a, i) => (\r\n              <React.Fragment key={i}>\r\n                <div className=\"label-div\">\r\n                  <Button\r\n                    variant=\"text\"\r\n                    onClick={e => {\r\n                      data.handleSelectAction(id, i);\r\n                      e.stopPropagation();\r\n                    }}\r\n                    className=\"lbl-action\"\r\n                  >\r\n                    {`Action: ${a.actionKey}\r\n                    ${a.actionInputs\r\n                      .map(ai => `${ai.key} - ${ai.value}`)\r\n                      .join(\", \")}`}\r\n                  </Button>\r\n                  <IconButton\r\n                    disableRipple\r\n                    onClick={e => {\r\n                      data.handleDeleteAction(id, i, a.actionKey);\r\n                      e.stopPropagation();\r\n                    }}\r\n                  >\r\n                    <HighlightOffIcon />\r\n                  </IconButton>\r\n                  {i !== data.item.length - 1 && (\r\n                    <Typography variant=\"h6\">AND</Typography>\r\n                  )}\r\n                </div>\r\n              </React.Fragment>\r\n            ))}\r\n\r\n            <Button\r\n              onClick={e => {\r\n                data.btnAction(id);\r\n                e.stopPropagation();\r\n              }}\r\n              variant=\"text\"\r\n            >\r\n              Add Action\r\n            </Button>\r\n          </>\r\n        ) : (\r\n          data.btnLabel && (\r\n            <Button\r\n              onClick={e => {\r\n                data.btnAction(id);\r\n                e.stopPropagation();\r\n              }}\r\n              variant=\"text\"\r\n            >\r\n              {data.btnLabel}\r\n            </Button>\r\n          )\r\n        ))}\r\n\r\n      {data.type === \"choice\" && (\r\n        <Typography variant=\"h6\" className=\"text-or\">\r\n          OR\r\n        </Typography>\r\n      )}\r\n\r\n      {data.btnLabel2 && (\r\n        <Button\r\n          onClick={e => {\r\n            data.btnAction2(id);\r\n            e.stopPropagation();\r\n          }}\r\n          variant=\"text\"\r\n        >\r\n          {data.btnLabel2}\r\n        </Button>\r\n      )}\r\n\r\n      <Handle\r\n        type=\"source\"\r\n        position=\"bottom\"\r\n        style={{ bottom: 10, top: \"auto\", background: \"transparent\" }}\r\n        isConnectable={isConnectable}\r\n      />\r\n    </div>\r\n  );\r\n});\r\n","import React, { useEffect, useState, useRef } from \"react\";\r\nimport ReactFlow, { removeElements, addEdge } from \"react-flow-renderer\";\r\n\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport { Events } from \"components/sidePanel/Events/Events\";\r\nimport { Conditions } from \"components/sidePanel/Conditions/Conditions\";\r\nimport { Actions } from \"components/sidePanel/Actions/Actions\";\r\nimport { Background } from \"components/common/Background/Background\";\r\nimport { CardHeader } from \"components/common/CardHeader/CardHeader\";\r\nimport ButtonSelectorNode from \"components/ButtonSelectorNode/ButtonSelectorNode\";\r\nimport { SAMPLE_EVENT_TRIGGERS, SAMPLE_FLOW } from \"constants/constants\";\r\nimport { setModalState } from \"states/modalState\";\r\n\r\nimport \"./HomePage.scss\";\r\n\r\nconst nodeTypes = {\r\n  btnSelectorNode: ButtonSelectorNode\r\n};\r\nlet totalConditionsCount = 0;\r\n\r\nfunction HomePage() {\r\n  useEffect(() => {\r\n    if (window.innerWidth < 768) {\r\n      setModalState({\r\n        title: \"Warning\",\r\n        subtitle: \"Device must be larger than 768px x 1024px to support flow\",\r\n        persistent: true\r\n      });\r\n    }\r\n  }, []);\r\n\r\n  const initEventNodeElement = (\r\n    item,\r\n    nodeId = 1,\r\n    position = { x: 250, y: 50 }\r\n  ) => ({\r\n    id: nodeId.toString(),\r\n    position,\r\n    type: \"btnSelectorNode\",\r\n    data: {\r\n      item,\r\n      type: \"event\",\r\n      label: \"When...\",\r\n      btnLabel: \"Select Event Trigger\",\r\n      focusNodeAction: id => {\r\n        setShowDrawer(\"events\");\r\n        setSelectedNode(id);\r\n      },\r\n      btnAction: id => {\r\n        setShowDrawer(\"events\");\r\n        setSelectedNode(id);\r\n      }\r\n    }\r\n  });\r\n\r\n  const initConditionNodeElement = (\r\n    item,\r\n    nodeId = 1,\r\n    position = { x: 250, y: 50 }\r\n  ) => ({\r\n    id: nodeId.toString(),\r\n    position,\r\n    type: \"btnSelectorNode\",\r\n    data: {\r\n      item,\r\n      type: \"condition\",\r\n      label: \"If...\",\r\n      btnLabel: \"Add condition\",\r\n      focusNodeAction: id => {\r\n        setShowDrawer(\"conditions\");\r\n        setSelectedNode(id);\r\n      },\r\n      handleSwapConditionArrows: id => handleSwapConditionArrows(id),\r\n      handleRemoveNode: (id, nodeType) => handleRemoveNode(id, nodeType),\r\n      btnAction: id => {\r\n        setShowDrawer(\"conditions\");\r\n        setSelectedNode(id);\r\n      }\r\n    }\r\n  });\r\n\r\n  const initActionNodeElement = (\r\n    item,\r\n    nodeId = 1,\r\n    position = { x: 250, y: 50 }\r\n  ) => ({\r\n    id: nodeId.toString(),\r\n    position,\r\n    type: \"btnSelectorNode\",\r\n    data: {\r\n      item,\r\n      type: \"action\",\r\n      label: \"Then...\",\r\n      btnLabel: \"Add action\",\r\n      focusNodeAction: id => {\r\n        setShowDrawer(null);\r\n        setSelectedActionIndex(null);\r\n        setSelectedNode(id);\r\n      },\r\n      btnAction: id => {\r\n        setShowDrawer(\"actions\");\r\n        setSelectedActionIndex(null);\r\n        setSelectedNode(id);\r\n      },\r\n      handleSelectAction: (id, itemIndex) => {\r\n        setShowDrawer(\"actions\");\r\n        setSelectedNode(id);\r\n        handleSelectAction(itemIndex);\r\n      },\r\n      handleDeleteAction: (id, itemIndex, actionKey) => {\r\n        setSelectedNode(id);\r\n        handleDeleteAction(id, itemIndex);\r\n      },\r\n      handleRemoveNode: (id, nodeType) => handleRemoveNode(id, nodeType)\r\n    }\r\n  });\r\n\r\n  const initChoiceNodeElement = (nodeId = 1, position = { x: 250, y: 50 }) => ({\r\n    id: nodeId.toString(),\r\n    position,\r\n    type: \"btnSelectorNode\",\r\n    data: {\r\n      type: \"choice\",\r\n      label: \"Next Step\",\r\n      btnLabel: \"Add condition\",\r\n      btnLabel2: \"Add action\",\r\n      focusNodeAction: id => {\r\n        setShowDrawer(null);\r\n        setSelectedNode(id);\r\n      },\r\n      btnAction: id => {\r\n        setShowDrawer(\"conditions\");\r\n        totalConditionsCount += 1;\r\n        setSelectedNode(id);\r\n\r\n        let tempElems = Object.assign([], elementsStateRef.current);\r\n        tempElems = tempElems.filter(\r\n          t =>\r\n            t.id !== nodeId &&\r\n            t.id !== `edges-${(Number(nodeId) - 1).toString()}-${nodeId}`\r\n        );\r\n        tempElems.push(\r\n          initConditionNodeElement(null, nodeId, position), // 2\r\n          initActionNodeElement(null, Number(nodeId) + 1, {\r\n            // 3 = yes\r\n            x: position.x - 250,\r\n            y: position.y + 150\r\n          }),\r\n          totalConditionsCount + 1 > 3 // reached max 3 conditions limit\r\n            ? initActionNodeElement(null, Number(nodeId) + 2, {\r\n                x: position.x + 300,\r\n                y: position.y + 150\r\n              })\r\n            : initChoiceNodeElement((Number(nodeId) + 2).toString(), {\r\n                x: position.x + 300,\r\n                y: position.y + 150\r\n              }),\r\n          ...(nodeId === \"2\"\r\n            ? [\r\n                initNodeEdge({\r\n                  source: (Number(nodeId) - 1).toString(),\r\n                  target: nodeId\r\n                })\r\n              ]\r\n            : []),\r\n          initNodeEdge({\r\n            source: nodeId,\r\n            target: (Number(nodeId) + 1).toString(), // edges-2-3\r\n            label: \"yes\",\r\n            labelBgPadding: [8, 4],\r\n            labelBgBorderRadius: 13,\r\n            labelStyle: { fill: \"#3b8dd6\", fontWeight: 700 },\r\n            labelBgStyle: { fill: \"#f1f7fb\" }\r\n          }),\r\n          initNodeEdge({\r\n            source: nodeId,\r\n            target: (Number(nodeId) + 2).toString(), // edges-2-4\r\n            label: \"no\",\r\n            labelBgPadding: [8, 4],\r\n            labelBgBorderRadius: 13,\r\n            labelStyle: { fill: \"#4a5568\", fontWeight: 700 },\r\n            labelBgStyle: { fill: \"#ececec\" }\r\n          })\r\n        );\r\n        setElements(tempElems);\r\n      },\r\n      btnAction2: id => {\r\n        setShowDrawer(\"actions\");\r\n        setSelectedNode(id);\r\n\r\n        let tempElems = Object.assign([], elementsStateRef.current);\r\n        tempElems = tempElems.filter(\r\n          t =>\r\n            t.id !== nodeId &&\r\n            t.id !== `edges-${(Number(nodeId) - 1).toString()}-${nodeId}` // edges-1-2\r\n        );\r\n        tempElems.push(\r\n          initActionNodeElement(null, nodeId, position),\r\n          ...(nodeId === \"2\"\r\n            ? [\r\n                initNodeEdge({\r\n                  source: (Number(nodeId) - 1).toString(),\r\n                  target: nodeId\r\n                })\r\n              ]\r\n            : [])\r\n        );\r\n\r\n        setElements(tempElems);\r\n      }\r\n    }\r\n  });\r\n\r\n  const initNodeEdge = ({ source, target, ...rest }) => ({\r\n    id: `edges-${source}-${target}`, // edges-1-2\r\n    source: source.toString(),\r\n    target: target.toString(),\r\n    type: \"default\",\r\n    ...rest\r\n  });\r\n\r\n  const [showDrawer, setShowDrawer] = useState(\"events\");\r\n  const [selectedNode, setSelectedNode] = useState(\"1\");\r\n  const [selectedActionIndex, setSelectedActionIndex] = useState(null);\r\n  const [elements, setElements] = useState([initEventNodeElement()]);\r\n  const onElementsRemove = elementsToRemove =>\r\n    setElements(els => removeElements(elementsToRemove, els));\r\n  const onConnect = params => setElements(els => addEdge(params, els));\r\n\r\n  const elementsStateRef = useRef();\r\n  elementsStateRef.current = elements;\r\n  const selectedNodeStateRef = useRef();\r\n  selectedNodeStateRef.current = selectedNode;\r\n\r\n  const handleEventChange = event => {\r\n    // setFlow({ ...flow, eventKey: event.eventKey });\r\n    // let tempElems = Object.assign([], elementsStateRef.current);\r\n    const tempElems = [initEventNodeElement(event)];\r\n\r\n    if (tempElems.length === 1) {\r\n      tempElems.push(\r\n        initChoiceNodeElement(\"2\", { x: 250, y: 180 }),\r\n        initNodeEdge({\r\n          source: \"1\",\r\n          target: \"2\"\r\n        })\r\n      );\r\n    }\r\n    setShowDrawer(null);\r\n    setElements(tempElems);\r\n  };\r\n\r\n  const handleConditionChange = conditionObj => {\r\n    let tempElems = Object.assign([], elementsStateRef.current);\r\n    let tempElemIndex = tempElems.findIndex(\r\n      t => t.id === selectedNodeStateRef.current\r\n    );\r\n    tempElems[tempElemIndex] = {\r\n      ...tempElems[tempElemIndex],\r\n      data: {\r\n        ...tempElems[tempElemIndex]?.data,\r\n        item: conditionObj\r\n      }\r\n    };\r\n    setElements(tempElems);\r\n  };\r\n\r\n  // type = add / update\r\n  const handleActionChange = (actionObj, type) => {\r\n    let tempElems = Object.assign([], elementsStateRef.current);\r\n    let tempElemIndex = tempElems.findIndex(\r\n      t => t.id === selectedNodeStateRef.current\r\n    );\r\n    tempElems[tempElemIndex] = {\r\n      ...tempElems[tempElemIndex],\r\n      data: {\r\n        ...tempElems[tempElemIndex]?.data,\r\n        item:\r\n          type === \"update\"\r\n            ? [\r\n                ...tempElems[tempElemIndex]?.data?.item.slice(\r\n                  0,\r\n                  selectedActionIndex\r\n                ),\r\n                actionObj,\r\n                ...tempElems[tempElemIndex]?.data?.item.slice(\r\n                  selectedActionIndex + 1\r\n                )\r\n              ]\r\n            : [...(tempElems[tempElemIndex]?.data?.item || []), actionObj]\r\n      }\r\n    };\r\n    setElements(tempElems);\r\n  };\r\n\r\n  const handleSelectAction = itemIndex => {\r\n    setSelectedActionIndex(itemIndex);\r\n  };\r\n\r\n  const handleDeleteAction = (nodeId, itemIndex) => {\r\n    let tempElems = Object.assign([], elementsStateRef.current);\r\n    let tempElemIndex = tempElems.findIndex(t => t.id === nodeId);\r\n    tempElems[tempElemIndex] = {\r\n      ...tempElems[tempElemIndex],\r\n      data: {\r\n        ...tempElems[tempElemIndex]?.data,\r\n        item: (tempElems[tempElemIndex]?.data?.item || []).filter(\r\n          (x, i) => i !== itemIndex\r\n        )\r\n      }\r\n    };\r\n    setElements(tempElems);\r\n    setShowDrawer(null);\r\n  };\r\n\r\n  const handleRemoveNode = (nodeId, nodeType) => {\r\n    let tempElems = Object.assign([], elementsStateRef.current);\r\n    const targetNode = tempElems.find(e => e.id === nodeId);\r\n\r\n    if (nodeType === \"condition\") {\r\n      totalConditionsCount = tempElems.filter(\r\n        e =>\r\n          e.type === \"btnSelectorNode\" &&\r\n          e.data.type === \"condition\" &&\r\n          e.id < nodeId\r\n      ).length;\r\n    }\r\n\r\n    setElements([\r\n      ...tempElems.filter(\r\n        e =>\r\n          e.type !== \"btnSelectorNode\" &&\r\n          !new RegExp(\r\n            tempElems\r\n              .filter(e => e.type === \"btnSelectorNode\" && e.id > nodeId)\r\n              .map(e => e.id)\r\n              .join(\"|\") || \"0\" // set '0' to test Regex if array return empty to return false, to prevent empty string test Regex returns true\r\n          ).test(e.id)\r\n      ),\r\n      ...tempElems.filter(e => e.id < nodeId),\r\n      initChoiceNodeElement(nodeId, targetNode.position)\r\n    ]);\r\n    setShowDrawer(null);\r\n  };\r\n\r\n  const handleSwapConditionArrows = nodeId => {\r\n    const tempElements = Object.assign([], elementsStateRef.current);\r\n    const yesNodeIndex = tempElements.findIndex(\r\n      el => el.source === nodeId && el.label === \"yes\"\r\n    );\r\n    const noNodeIndex = tempElements.findIndex(\r\n      el => el.source === nodeId && el.label === \"no\"\r\n    );\r\n    tempElements[yesNodeIndex].label =\r\n      tempElements[yesNodeIndex].label === \"yes\" ? \"no\" : \"yes\";\r\n    tempElements[noNodeIndex].label =\r\n      tempElements[noNodeIndex].label === \"yes\" ? \"no\" : \"yes\";\r\n    setElements(tempElements);\r\n  };\r\n\r\n  const recursionFormObj = (tempElems, nodeId) => {\r\n    let obj = {\r\n      \"Fn::If\": [\r\n        tempElems.find(el => el.id === nodeId).data?.item\r\n          ? [tempElems.find(el => el.id === nodeId).data?.item]\r\n          : []\r\n      ]\r\n    };\r\n\r\n    tempElems = tempElems.filter(\r\n      el => el.target !== nodeId && el.id !== nodeId\r\n    );\r\n\r\n    // condition-yes-action\r\n    const yesNodeId = tempElems.find(\r\n      el => el.source === nodeId && el.label === \"yes\"\r\n    ).target;\r\n    if (tempElems.find(el => el.id === yesNodeId).data?.type === \"condition\") {\r\n      // recursion and return object to be pushed in to second array\r\n      obj[\"Fn::If\"].push([recursionFormObj(tempElems, nodeId)]);\r\n    } else {\r\n      obj[\"Fn::If\"].push(\r\n        tempElems.find(el => el.id === yesNodeId).data?.item || []\r\n      );\r\n    }\r\n    tempElems = tempElems.filter(\r\n      el => el.target !== yesNodeId && el.id !== yesNodeId\r\n    );\r\n\r\n    // condition-no-action\r\n    const noNodeId = tempElems.find(\r\n      el => el.source === nodeId && el.label === \"no\"\r\n    ).target;\r\n    if (tempElems.find(el => el.id === noNodeId).data?.type === \"condition\") {\r\n      // recursion and return object to be pushed in to third array\r\n      obj[\"Fn::If\"].push([recursionFormObj(tempElems, noNodeId)]);\r\n    } else {\r\n      obj[\"Fn::If\"].push(\r\n        tempElems.find(el => el.id === noNodeId).data?.item || []\r\n      );\r\n    }\r\n    tempElems = tempElems.filter(\r\n      el => el.target !== noNodeId && el.id !== noNodeId\r\n    );\r\n\r\n    return obj;\r\n  };\r\n\r\n  const handleSave = () => {\r\n    let tempElems = Object.assign([], elements);\r\n    const output = {\r\n      eventKey: \"\",\r\n      conditions: []\r\n    };\r\n\r\n    // Incomplete flow\r\n    if (\r\n      tempElems.filter(el => el.type === \"btnSelectorNode\" && !el.data.item)\r\n        .length\r\n    ) {\r\n      setModalState({\r\n        title: \"Warning\",\r\n        subtitle: \"Please complete the flow first before saving\",\r\n        btnLabel: \"OK\"\r\n      });\r\n      return;\r\n    }\r\n\r\n    let i = 0;\r\n    while (tempElems.length > 0) {\r\n      let nodeId = tempElems[i].id;\r\n      if (tempElems[i].data?.type === \"event\") {\r\n        output.eventKey = tempElems[i].data?.item?.eventKey;\r\n        tempElems.splice(i, 1);\r\n      } else if (tempElems[i].data?.type === \"condition\") {\r\n        output.conditions.push(recursionFormObj(tempElems, nodeId));\r\n        break;\r\n      } else if (\r\n        tempElems.filter(el => el.type === \"btnSelectorNode\").length === 1 &&\r\n        tempElems[i].data?.type === \"action\"\r\n      ) {\r\n        output.conditions.push({\r\n          \"Fn::If\": [[{ noCondition: true }], tempElems[i].data?.item || [], []]\r\n        });\r\n        // Delete node and edge\r\n        tempElems = tempElems.filter(\r\n          el => el.id !== nodeId && el.target !== nodeId\r\n        );\r\n      } else if (tempElems[i].data?.type === \"choice\") {\r\n        return;\r\n      } else {\r\n        i++;\r\n      }\r\n    }\r\n\r\n    console.log(\"output\", output);\r\n  };\r\n\r\n  const recursionFromElement = (conditionObj, nodeId, position) => {\r\n    return [\r\n      initConditionNodeElement(\r\n        Object.values(conditionObj[0])[0],\r\n        nodeId,\r\n        position\r\n      ), // 2\r\n      initActionNodeElement(conditionObj[2], nodeId + 1, {\r\n        // 3\r\n        x: position.x - 250,\r\n        y: position.y + 150\r\n      }),\r\n      ...(Object.keys(conditionObj[1][0])[0].includes(\"Fn::\")\r\n        ? recursionFromElement(\r\n            Object.values(conditionObj[1][0])[0],\r\n            nodeId + 2, // 4\r\n            {\r\n              x: position.x + 300,\r\n              y: position.y + 150\r\n            }\r\n          )\r\n        : [\r\n            initActionNodeElement(conditionObj[1], nodeId + 2, {\r\n              // 3\r\n              x: position.x + 300,\r\n              y: position.y + 150\r\n            })\r\n          ]),\r\n      initNodeEdge({\r\n        source: nodeId,\r\n        target: Number(nodeId) + 1,\r\n        label: \"yes\",\r\n        labelBgPadding: [8, 4],\r\n        labelBgBorderRadius: 13,\r\n        labelStyle: { fill: \"#3b8dd6\", fontWeight: 700 },\r\n        labelBgStyle: { fill: \"#f1f7fb\" }\r\n      }),\r\n      initNodeEdge({\r\n        source: nodeId,\r\n        target: Number(nodeId) + 2,\r\n        label: \"no\",\r\n        labelBgPadding: [8, 4],\r\n        labelBgBorderRadius: 13,\r\n        labelStyle: { fill: \"#4a5568\", fontWeight: 700 },\r\n        labelBgStyle: { fill: \"#ececec\" }\r\n      })\r\n    ];\r\n  };\r\n\r\n  const handlePreview = () => {\r\n    let nodeId = 1;\r\n    let position = { x: 250, y: 200 };\r\n    let initialElements = [];\r\n    const sampleFlowConditions = Object.assign(\r\n      [],\r\n      SAMPLE_FLOW.conditions[0][\"Fn::If\"]\r\n    );\r\n\r\n    // Event\r\n    initialElements.push(\r\n      initEventNodeElement(\r\n        SAMPLE_EVENT_TRIGGERS.find(t => t.eventKey === SAMPLE_FLOW.eventKey)\r\n      )\r\n    );\r\n\r\n    // Condition + Action\r\n    let i = 0;\r\n    while (i < 3) {\r\n      nodeId += 1;\r\n      if (\r\n        Object.keys(sampleFlowConditions[i]).includes(\"Fn::\") ||\r\n        Object.keys(sampleFlowConditions[i].includes(\"conditionKey\"))\r\n      ) {\r\n        // Condition\r\n        initialElements = [\r\n          ...initialElements,\r\n          ...recursionFromElement(sampleFlowConditions, nodeId, position),\r\n          initNodeEdge({\r\n            source: \"1\",\r\n            target: \"2\"\r\n          })\r\n        ];\r\n        // i += 2 because both yes and no actions for the condition already pushed into array\r\n        // to complete / stop the loop\r\n        i += 2;\r\n      } else if (sampleFlowConditions[i + 1]) {\r\n        // Action\r\n        initialElements.push(\r\n          initActionNodeElement(sampleFlowConditions[i + 1], nodeId, {\r\n            x: 250,\r\n            y: 50\r\n          }),\r\n          initNodeEdge({\r\n            source: (Number(nodeId) - 1).toString(),\r\n            target: nodeId\r\n          })\r\n        );\r\n      }\r\n      i++;\r\n    }\r\n    setElements(initialElements);\r\n  };\r\n\r\n  // Handle lose focus on node to hide drawer\r\n  const handleOnSelectionChange = e => {\r\n    if (!e) {\r\n      setShowDrawer(null);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Background fullHeight color=\"HomePage grey100\">\r\n      {showDrawer && (\r\n        <div className=\"drawer\">\r\n          {showDrawer === \"events\" && (\r\n            <Events\r\n              selectedEventKey={\r\n                elements.find(e => e.data?.type === \"event\").data?.item\r\n                  ?.eventKey\r\n              }\r\n              handleSelect={handleEventChange}\r\n            />\r\n          )}\r\n\r\n          {showDrawer === \"conditions\" && (\r\n            <Conditions\r\n              selectedEventKey={\r\n                elements.find(e => e.data?.type === \"event\").data?.item\r\n                  ?.eventKey\r\n              }\r\n              selectedConditionObj={\r\n                elementsStateRef.current.find(\r\n                  el => el.id === selectedNodeStateRef.current\r\n                )?.data?.item || {}\r\n              }\r\n              handleSelect={handleConditionChange}\r\n            />\r\n          )}\r\n\r\n          {showDrawer === \"actions\" && (\r\n            <Actions\r\n              actionsArr={\r\n                elementsStateRef.current.find(\r\n                  el => el.id === selectedNodeStateRef.current\r\n                )?.data?.item || []\r\n              }\r\n              selectedActionObj={\r\n                (elementsStateRef.current.find(\r\n                  el => el.id === selectedNodeStateRef.current\r\n                )?.data?.item || [])[selectedActionIndex] || {}\r\n              }\r\n              handleSelect={handleActionChange}\r\n            />\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"home-section\">\r\n        <CardHeader\r\n          hasPreviewButton\r\n          handlePreview={handlePreview}\r\n          handleSave={handleSave}\r\n        >\r\n          <Typography variant=\"h3\">Map your automation</Typography>\r\n        </CardHeader>\r\n        <div className=\"flow-body\">\r\n          <ReactFlow\r\n            elementsSelectable={true}\r\n            elements={elements}\r\n            onElementsRemove={onElementsRemove}\r\n            onConnect={onConnect}\r\n            nodeTypes={nodeTypes}\r\n            // deleteKeyCode={46} /* 'delete'-key */\r\n            onSelectionChange={handleOnSelectionChange}\r\n          />\r\n        </div>\r\n      </div>\r\n    </Background>\r\n  );\r\n}\r\n\r\nexport default HomePage;\r\n"],"sourceRoot":""}